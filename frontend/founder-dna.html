<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Founder DNA - PitchLense</title>
    <link rel="icon" type="image/svg+xml" href="/static/logo.svg">
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="styles.css">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <style>
        .progress-bar-container {
            width: 100%;
            background-color: rgba(255, 255, 255, 0.1);
            border-radius: 0.5rem;
            overflow: hidden;
            height: 24px;
        }
        .progress-bar {
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: flex-end;
            padding-right: 0.75rem;
            font-size: 0.875rem;
            font-weight: 600;
            color: white;
            transition: width 0.8s ease-in-out;
        }
        .score-excellent { background: linear-gradient(90deg, #10b981 0%, #059669 100%); }
        .score-good { background: linear-gradient(90deg, #3b82f6 0%, #2563eb 100%); }
        .score-average { background: linear-gradient(90deg, #f59e0b 0%, #d97706 100%); }
        .score-poor { background: linear-gradient(90deg, #ef4444 0%, #dc2626 100%); }
        
        .kpi-card {
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 1.5rem;
            transition: all 0.3s ease;
        }
        .kpi-card:hover {
            background: rgba(255, 255, 255, 0.05);
            border-color: rgba(241, 216, 91, 0.3);
            transform: translateY(-2px);
        }
        
        .upload-zone {
            border: 2px dashed rgba(255, 255, 255, 0.2);
            border-radius: 12px;
            padding: 3rem;
            transition: all 0.3s ease;
        }
        .upload-zone:hover {
            border-color: rgba(241, 216, 91, 0.5);
            background: rgba(241, 216, 91, 0.05);
        }
        .upload-zone.dragover {
            border-color: #FFF27A;
            background: rgba(241, 216, 91, 0.1);
        }
    </style>
</head>
<body class="bg-background text-text font-sans antialiased overflow-x-hidden bg-solid">
    <div id="app" class="h-screen flex flex-col p-3 gap-3">
        <!-- Header -->
        <header class="h-16 bg-[#2E3137] border border-white/10 rounded-[22px] flex items-center justify-between px-6 mobile-header flex-shrink-0">
            <div class="flex items-center gap-3">
                <div class="w-8 h-8 rounded-full grid place-items-center">
                    <img src="/static/logo.svg" alt="PitchLense" class="w-5 h-5" />
                </div>
                <span class="text-base font-semibold">Founder DNA</span>
            </div>
            <div class="flex items-center gap-3">
                <div id="userProfileIcon" class="w-9 h-9 rounded-full border border-white/15 bg-[#FFF27A] grid place-items-center text-[#1E1E21] relative group">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="18" height="18" fill="currentColor">
                        <path d="M12 12a4 4 0 1 0-4-4 4 4 0 0 0 4 4Zm0 2c-3.31 0-6 2.69-6 6h12c0-3.31-2.69-6-6-6Z"/>
                    </svg>
                    <div id="userEmailTooltip" class="absolute top-full left-1/2 transform -translate-x-1/2 mt-2 px-3 py-2 bg-[#1E1E21] text-white text-sm rounded-lg shadow-lg opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-200 whitespace-nowrap z-50">
                        <span id="userEmailText">Loading...</span>
                        <div class="absolute bottom-full left-1/2 transform -translate-x-1/2 w-0 h-0 border-l-4 border-r-4 border-b-4 border-transparent border-b-[#1E1E21]"></div>
                    </div>
                </div>
            </div>
        </header>

        <div class="grid flex-1 min-h-0 mobile-navbar" style="grid-template-columns: 84px 1fr; gap:12px;">
            <!-- Sidebar Navigation -->
            <aside id="pitchlense-navbar" class="bg-[#2C2F34] border border-white/10 rounded-[18px] flex flex-col items-center py-4 gap-3">
                <!-- Navigation will be loaded by navbar.js -->
            </aside>

            <!-- Main Content -->
            <main class="flex-1 flex flex-col overflow-hidden bg-[#2E3137] border border-white/10 rounded-[14px] p-6 mobile-main">
                <div class="flex-1 overflow-y-auto">
                    <!-- Upload Section -->
                    <div id="upload-section" class="max-w-4xl mx-auto">
                        <div class="text-center mb-8">
                            <h1 class="text-3xl font-bold text-white mb-2">ðŸ§¬ Founder DNA Analyzer</h1>
                            <p class="text-lg text-white/70">Upload a LinkedIn profile PDF for comprehensive founder evaluation</p>
                        </div>

                        <div class="bg-[#2C2F34] border border-white/10 rounded-xl p-8">
                            <div id="upload-zone" class="upload-zone text-center">
                                <svg class="mx-auto h-16 w-16 text-white/40 mb-4" stroke="currentColor" fill="none" viewBox="0 0 48 48">
                                    <path d="M28 8H12a4 4 0 00-4 4v20m32-12v8m0 0v8a4 4 0 01-4 4H12a4 4 0 01-4-4v-4m32-4l-3.172-3.172a4 4 0 00-5.656 0L28 28M8 32l9.172-9.172a4 4 0 015.656 0L28 28m0 0l4 4m4-24h8m-4-4v8" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                                </svg>
                                <label for="pdf-upload" class="relative cursor-pointer">
                                    <span class="text-[#FFF27A] hover:text-[#f0e068] font-semibold text-lg">Choose file</span>
                                    <span class="text-white/60"> or drag and drop</span>
                                    <input id="pdf-upload" name="pdf-upload" type="file" class="sr-only" accept=".pdf">
                                </label>
                                <p class="text-sm text-white/50 mt-2">LinkedIn Profile PDF up to 10MB</p>
                                <p id="file-name" class="mt-4 text-white/80 font-medium"></p>
                            </div>
                            <button id="analyze-btn" class="mt-6 w-full bg-[#FFF27A] text-[#1E1E21] font-semibold py-3 px-6 rounded-lg hover:bg-[#f0e068] disabled:bg-gray-600 disabled:text-white/40 disabled:cursor-not-allowed transition-all" disabled>
                                ðŸš€ Analyze Founder Profile
                            </button>
                        </div>
                    </div>

                    <!-- Loading State -->
                    <div id="loading-section" class="hidden text-center py-16">
                        <div class="inline-flex items-center justify-center space-x-2">
                            <svg class="animate-spin h-12 w-12 text-[#FFF27A]" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                                <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                                <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                            </svg>
                        </div>
                        <p class="mt-6 text-xl text-white/90">ðŸ§  AI is analyzing the founder profile...</p>
                        <p class="mt-2 text-white/60">This may take 30-60 seconds</p>
                    </div>

                    <!-- Results Section -->
                    <div id="results-section" class="hidden max-w-7xl mx-auto space-y-6">
                        <!-- Header with Overall Score -->
                        <div class="bg-gradient-to-r from-[#2C2F34] to-[#2E3137] border border-white/10 rounded-xl p-8 text-center">
                            <h2 class="text-3xl font-bold text-white mb-2">Analysis Complete</h2>
                            <div class="flex items-center justify-center gap-4 mt-6">
                                <div class="text-center">
                                    <div id="overall-score" class="text-6xl font-bold text-[#FFF27A]">--</div>
                                    <div class="text-sm text-white/60 mt-2">Overall Founder Score</div>
                                </div>
                                <div class="text-left">
                                    <div id="overall-rating" class="text-2xl font-bold text-white">--</div>
                                    <div id="overall-recommendation" class="text-sm text-white/70 max-w-md mt-1">--</div>
                                </div>
                            </div>
                        </div>

                        <!-- Executive Summary -->
                        <div class="bg-[#2C2F34] border border-white/10 rounded-xl p-6">
                            <h3 class="text-xl font-bold text-white mb-4 flex items-center gap-2">
                                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="24" height="24" fill="none" stroke="currentColor" stroke-width="2" class="text-[#FFF27A]">
                                    <path d="M9 11l3 3L22 4"></path>
                                    <path d="M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11"></path>
                                </svg>
                                Executive Summary
                            </h3>
                            <p id="summary-content" class="text-white/80 leading-relaxed"></p>
                        </div>

                        <!-- Core Competency Scores -->
                        <div class="bg-[#2C2F34] border border-white/10 rounded-xl p-6">
                            <h3 class="text-xl font-bold text-white mb-6 flex items-center gap-2">
                                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="24" height="24" fill="none" stroke="currentColor" stroke-width="2" class="text-[#FFF27A]">
                                    <line x1="12" y1="20" x2="12" y2="10"></line>
                                    <line x1="18" y1="20" x2="18" y2="4"></line>
                                    <line x1="6" y1="20" x2="6" y2="16"></line>
                                </svg>
                                Core Competency Scores
                            </h3>
                            <div id="scores-content" class="space-y-5"></div>
                        </div>

                        <!-- Detailed KPIs Grid -->
                        <div class="bg-[#2C2F34] border border-white/10 rounded-xl p-6">
                            <h3 class="text-xl font-bold text-white mb-6 flex items-center gap-2">
                                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="24" height="24" fill="none" stroke="currentColor" stroke-width="2" class="text-[#FFF27A]">
                                    <polyline points="22 12 18 12 15 21 9 3 6 12 2 12"></polyline>
                                </svg>
                                Detailed KPIs & Metrics
                            </h3>
                            <div id="kpis-content" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4"></div>
                        </div>

                        <!-- Strengths & Risks -->
                        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                            <!-- Strengths -->
                            <div class="bg-[#2C2F34] border border-white/10 rounded-xl p-6">
                                <h3 class="text-xl font-bold text-white mb-4 flex items-center gap-2">
                                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="24" height="24" fill="none" stroke="currentColor" stroke-width="2" class="text-green-400">
                                        <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path>
                                        <polyline points="22 4 12 14.01 9 11.01"></polyline>
                                    </svg>
                                    Key Strengths
                                </h3>
                                <ul id="strengths-content" class="space-y-3"></ul>
                            </div>

                            <!-- Risks -->
                            <div class="bg-[#2C2F34] border border-white/10 rounded-xl p-6">
                                <h3 class="text-xl font-bold text-white mb-4 flex items-center gap-2">
                                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="24" height="24" fill="none" stroke="currentColor" stroke-width="2" class="text-red-400">
                                        <path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"></path>
                                        <line x1="12" y1="9" x2="12" y2="13"></line>
                                        <line x1="12" y1="17" x2="12.01" y2="17"></line>
                                    </svg>
                                    Potential Risks & Red Flags
                                </h3>
                                <ul id="risks-content" class="space-y-3"></ul>
                            </div>
                        </div>

                        <!-- Investment Recommendation -->
                        <div class="bg-[#2C2F34] border border-white/10 rounded-xl p-6">
                            <h3 class="text-xl font-bold text-white mb-4 flex items-center gap-2">
                                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="24" height="24" fill="none" stroke="currentColor" stroke-width="2" class="text-[#FFF27A]">
                                    <line x1="12" y1="1" x2="12" y2="23"></line>
                                    <path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"></path>
                                </svg>
                                Investment Recommendation
                            </h3>
                            <div id="recommendation-content" class="text-white/80 leading-relaxed"></div>
                        </div>

                        <!-- Analyze Another Button -->
                        <div class="text-center pt-4">
                            <button id="analyze-another-btn" class="bg-[#FFF27A] text-[#1E1E21] font-semibold py-3 px-8 rounded-lg hover:bg-[#f0e068] transition-all">
                                Analyze Another Profile
                            </button>
                        </div>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <!-- Load Navbar Component -->
    <script src="/static/navbar.js"></script>
    <script>
        // Initialize
        const userEmail = localStorage.getItem('userEmail');
        if (userEmail) {
            document.getElementById('userEmailText').textContent = userEmail;
        }

        // DOM Elements
        const pdfUpload = document.getElementById('pdf-upload');
        const analyzeBtn = document.getElementById('analyze-btn');
        const fileNameDisplay = document.getElementById('file-name');
        const uploadZone = document.getElementById('upload-zone');
        const uploadSection = document.getElementById('upload-section');
        const loadingSection = document.getElementById('loading-section');
        const resultsSection = document.getElementById('results-section');
        const analyzeAnotherBtn = document.getElementById('analyze-another-btn');

        let uploadedFile = null;

        // Drag and Drop
        uploadZone.addEventListener('dragover', (e) => {
            e.preventDefault();
            uploadZone.classList.add('dragover');
        });

        uploadZone.addEventListener('dragleave', () => {
            uploadZone.classList.remove('dragover');
        });

        uploadZone.addEventListener('drop', (e) => {
            e.preventDefault();
            uploadZone.classList.remove('dragover');
            const file = e.dataTransfer.files[0];
            if (file && file.type === 'application/pdf') {
                pdfUpload.files = e.dataTransfer.files;
                handleFileSelection(file);
            }
        });

        // File Selection
        pdfUpload.addEventListener('change', (e) => {
            const file = e.target.files[0];
            if (file) handleFileSelection(file);
        });

        function handleFileSelection(file) {
            if (file.type === 'application/pdf') {
                if (file.size > 10 * 1024 * 1024) {
                    Swal.fire({
                        icon: 'error',
                        title: 'File Too Large',
                        text: 'Please select a PDF file under 10MB.',
                        confirmButtonText: 'OK'
                    });
                    return;
                }
                uploadedFile = file;
                fileNameDisplay.textContent = `ðŸ“„ ${file.name}`;
                analyzeBtn.disabled = false;
            } else {
                uploadedFile = null;
                fileNameDisplay.textContent = 'Please select a valid PDF file.';
                analyzeBtn.disabled = true;
            }
        }

        // Analyze Button
        analyzeBtn.addEventListener('click', analyzeProfile);
        analyzeAnotherBtn.addEventListener('click', () => {
            uploadedFile = null;
            fileNameDisplay.textContent = '';
            pdfUpload.value = '';
            analyzeBtn.disabled = true;
            uploadSection.classList.remove('hidden');
            resultsSection.classList.add('hidden');
        });

        async function analyzeProfile() {
            if (!uploadedFile) return;

            uploadSection.classList.add('hidden');
            resultsSection.classList.add('hidden');
            loadingSection.classList.remove('hidden');

            try {
                const formData = new FormData();
                formData.append('pdf', uploadedFile);

                const response = await fetch('/api/founder-dna/analyze', {
                    method: 'POST',
                    credentials: 'include',
                    body: formData
                });

                if (!response.ok) {
                    const error = await response.json();
                    throw new Error(error.error || 'Analysis failed');
                }

                const result = await response.json();
                displayResults(result.analysis);

            } catch (error) {
                console.error('Analysis failed:', error);
                Swal.fire({
                    icon: 'error',
                    title: 'Analysis Failed',
                    text: error.message,
                    confirmButtonText: 'OK'
                });
                uploadSection.classList.remove('hidden');
            } finally {
                loadingSection.classList.add('hidden');
            }
        }

        function displayResults(data) {
            // Overall Score
            document.getElementById('overall-score').textContent = data.overallScore || '--';
            document.getElementById('overall-rating').textContent = data.overallRating || '--';
            document.getElementById('overall-recommendation').textContent = data.overallSummary || '';

            // Executive Summary
            document.getElementById('summary-content').textContent = data.summary;

            // Core Competency Scores
            const scoresContainer = document.getElementById('scores-content');
            scoresContainer.innerHTML = '';
            data.scores.forEach(item => {
                const score = parseInt(item.score, 10);
                const scoreClass = score >= 80 ? 'score-excellent' : score >= 65 ? 'score-good' : score >= 50 ? 'score-average' : 'score-poor';
                const scoreElement = document.createElement('div');
                scoreElement.innerHTML = `
                    <div class="flex justify-between items-center mb-2">
                        <span class="font-semibold text-white">${item.competency}</span>
                        <span class="text-sm text-white/60">${score}/100</span>
                    </div>
                    <div class="progress-bar-container mb-2">
                        <div class="progress-bar ${scoreClass}" style="width: ${score}%;">${score}%</div>
                    </div>
                    <p class="text-sm text-white/70">${item.justification}</p>
                `;
                scoresContainer.appendChild(scoreElement);
            });

            // Detailed KPIs
            const kpisContainer = document.getElementById('kpis-content');
            kpisContainer.innerHTML = '';
            data.detailedKPIs.forEach(kpi => {
                const kpiCard = document.createElement('div');
                kpiCard.className = 'kpi-card';
                kpiCard.innerHTML = `
                    <div class="text-2xl mb-2">${kpi.icon}</div>
                    <h4 class="font-bold text-white mb-1">${kpi.metric}</h4>
                    <div class="text-2xl font-bold text-[#FFF27A] mb-1">${kpi.value}</div>
                    <p class="text-xs text-white/60">${kpi.description}</p>
                `;
                kpisContainer.appendChild(kpiCard);
            });

            // Strengths
            const strengthsContainer = document.getElementById('strengths-content');
            strengthsContainer.innerHTML = '';
            data.keyStrengths.forEach(strength => {
                const li = document.createElement('li');
                li.className = 'flex items-start gap-3 text-white/80';
                li.innerHTML = `
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="20" height="20" fill="none" stroke="currentColor" stroke-width="2" class="text-green-400 flex-shrink-0 mt-0.5">
                        <polyline points="20 6 9 17 4 12"></polyline>
                    </svg>
                    <span>${strength}</span>
                `;
                strengthsContainer.appendChild(li);
            });

            // Risks
            const risksContainer = document.getElementById('risks-content');
            risksContainer.innerHTML = '';
            data.potentialRisks.forEach(risk => {
                const li = document.createElement('li');
                li.className = 'flex items-start gap-3 text-white/80';
                li.innerHTML = `
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="20" height="20" fill="none" stroke="currentColor" stroke-width="2" class="text-red-400 flex-shrink-0 mt-0.5">
                        <circle cx="12" cy="12" r="10"></circle>
                        <line x1="12" y1="8" x2="12" y2="12"></line>
                        <line x1="12" y1="16" x2="12.01" y2="16"></line>
                    </svg>
                    <span>${risk}</span>
                `;
                risksContainer.appendChild(li);
            });

            // Investment Recommendation
            document.getElementById('recommendation-content').textContent = data.investmentRecommendation;

            // Show results
            resultsSection.classList.remove('hidden');
        }
    </script>
</body>
</html>


