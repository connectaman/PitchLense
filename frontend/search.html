<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Search - PitchLense</title>
    <link rel="icon" type="image/svg+xml" href="/static/logo.svg">
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="styles.css">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        .search-container {
            background: #2E3137;
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 18px;
        }

        .search-input {
            background: #1E1E21;
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 12px;
        }

        .search-input:focus {
            outline: none;
            border-color: #FFF27A;
            box-shadow: 0 0 0 2px rgba(241, 216, 91, 0.2);
        }

        .search-result {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
            transition: all 0.2s;
            cursor: pointer;
        }

        .search-result:hover {
            background: rgba(255, 255, 255, 0.1);
            transform: translateY(-2px);
        }

        .symbol-badge {
            background: #FFF27A;
            color: #1E1E21;
            font-weight: 600;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.75rem;
        }

        .price-positive {
            color: #10b981;
        }

        .price-negative {
            color: #ef4444;
        }

        .data-card {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 1.5rem;
        }

        .kpi-card {
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            padding: 1rem;
        }

        .section-title {
            font-size: 1.25rem;
            font-weight: 600;
            margin-bottom: 1rem;
            color: #FFF27A;
        }

        .table-container {
            overflow-x: auto;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        th {
            background: rgba(255, 255, 255, 0.05);
            padding: 0.75rem;
            text-align: left;
            font-weight: 600;
            border-bottom: 2px solid rgba(255, 255, 255, 0.1);
        }

        td {
            padding: 0.75rem;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        }

        .spinner {
            border: 3px solid rgba(255, 255, 255, 0.1);
            border-top: 3px solid #FFF27A;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* SweetAlert2 Custom Styles */
        .swal2-popup {
            background: #2E3137 !important;
            color: white !important;
        }
        .swal2-title {
            color: white !important;
        }
        .swal2-html-container {
            color: rgba(255, 255, 255, 0.8) !important;
        }
        .swal2-confirm {
            background-color: #FFF27A !important;
            color: #1E1E21 !important;
        }
        .swal2-cancel {
            background-color: rgba(255, 255, 255, 0.1) !important;
            color: white !important;
        }

        .news-item {
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            padding: 1rem;
            margin-bottom: 1rem;
            transition: all 0.2s;
        }

        .news-item:hover {
            background: rgba(255, 255, 255, 0.05);
        }

        .sentiment-bullish {
            color: #10b981;
        }

        .sentiment-bearish {
            color: #ef4444;
        }

        .sentiment-neutral {
            color: #94a3b8;
        }
    </style>
</head>
<body class="bg-background text-text font-sans antialiased overflow-x-hidden bg-solid">
    <div id="app" class="h-screen flex flex-col p-3 gap-3">
    <!-- Header -->
    <header class="h-16 bg-[#2E3137] border border-white/10 rounded-[22px] flex items-center justify-between px-6 mobile-header flex-shrink-0">
        <div class="flex items-center gap-3">
          <div class="w-8 h-8 rounded-full grid place-items-center">
            <img src="/static/logo.svg" alt="PitchLense" class="w-5 h-5" />
          </div>
          <span class="text-base font-semibold">Search Symbols</span>
        </div>
        <div class="flex items-center gap-3">
          <!-- Mobile menu button -->
          <button id="mobileMenuBtn" class="md:hidden w-9 h-9 grid place-items-center rounded-full bg-[#FFF27A] border border-white/10 text-[#1E1E21]">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="16" height="16" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <line x1="3" y1="6" x2="21" y2="6"/>
              <line x1="3" y1="12" x2="21" y2="12"/>
              <line x1="3" y1="18" x2="21" y2="18"/>
            </svg>
          </button>
          <div id="userProfileIcon" class="w-9 h-9 rounded-full border border-white/15 bg-[#FFF27A] grid place-items-center text-[#1E1E21] relative group">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="18" height="18" fill="currentColor">
              <path d="M12 12a4 4 0 1 0-4-4 4 4 0 0 0 4 4Zm0 2c-3.31 0-6 2.69-6 6h12c0-3.31-2.69-6-6-6Z"/>
            </svg>
            <!-- User email tooltip -->
            <div id="userEmailTooltip" class="absolute top-full left-1/2 transform -translate-x-1/2 mt-2 px-3 py-2 bg-[#1E1E21] text-white text-sm rounded-lg shadow-lg opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-200 whitespace-nowrap z-50">
              <span id="userEmailText">Loading...</span>
              <!-- Tooltip arrow -->
              <div class="absolute bottom-full left-1/2 transform -translate-x-1/2 w-0 h-0 border-l-4 border-r-4 border-b-4 border-transparent border-b-[#1E1E21]"></div>
            </div>
          </div>
        </div>
      </header>

      <div class="grid flex-1 min-h-0 mobile-navbar" style="grid-template-columns: 84px 1fr; gap:12px;">
        <!-- Mobile responsive styles -->
        <style>
          @media (max-width: 768px) {
            .mobile-navbar {
              grid-template-columns: 1fr !important;
              gap: 8px !important;
            }
            .mobile-main {
              padding: 12px !important;
            }
            .mobile-header {
              padding: 12px 16px !important;
            }
            #pitchlense-navbar {
              display: none !important;
            }
            
            /* Search Header Mobile */
            .search-header {
              padding: 16px !important;
            }
            .search-title {
              font-size: 1.5rem !important;
              margin-bottom: 12px !important;
            }
            .search-input {
              font-size: 14px !important;
              padding: 12px 12px 12px 40px !important;
            }
            .search-btn {
              padding: 8px 12px !important;
              font-size: 14px !important;
            }
            .quick-search-text {
              font-size: 12px !important;
            }
            .quick-search-buttons {
              display: grid !important;
              grid-template-columns: repeat(5, 1fr) !important;
              gap: 4px !important;
            }
            
            /* Desktop styles */
            @media (min-width: 769px) {
              .quick-search-buttons {
                display: flex !important;
                flex-wrap: wrap !important;
                gap: 8px !important;
              }
              
              .company-title-section {
                display: flex !important;
              }
              
              .mobile-company-header {
                display: none !important;
              }
            }
            
            /* Search Results Mobile */
            .search-results-container {
              padding: 12px !important;
            }
            .search-result {
              padding: 12px !important;
              margin-bottom: 8px !important;
            }
            .search-result-content {
              flex-direction: column !important;
              align-items: flex-start !important;
              gap: 8px !important;
            }
            .search-result-header {
              flex-direction: row !important;
              align-items: center !important;
              gap: 8px !important;
              flex-wrap: wrap !important;
            }
            .search-result-symbol {
              font-size: 14px !important;
              padding: 4px 8px !important;
            }
            .search-result-name {
              font-size: 16px !important;
              line-height: 1.3 !important;
              flex: 1 !important;
              min-width: 0 !important;
            }
            .search-result-exchange {
              font-size: 10px !important;
              padding: 2px 6px !important;
            }
            .search-result-details {
              font-size: 12px !important;
            }
            
            /* Company View Mobile */
            .company-header {
              padding: 16px !important;
            }
            .company-title-section {
              display: none !important;
            }
            
            .mobile-company-header {
              display: block !important;
            }
            .company-symbol {
              font-size: 18px !important;
              padding: 6px 12px !important;
            }
            .company-name {
              font-size: 1.5rem !important;
              line-height: 1.2 !important;
              flex: 1 !important;
              min-width: 0 !important;
            }
            .company-meta {
              flex-direction: column !important;
              align-items: flex-start !important;
              gap: 4px !important;
            }
            .company-meta span {
              font-size: 12px !important;
            }
            
            /* Tabs Mobile */
            .tabs-container {
              padding: 0 16px !important;
              overflow-x: auto !important;
              -webkit-overflow-scrolling: touch !important;
            }
            .tabs {
              min-width: max-content !important;
              gap: 8px !important;
            }
            .tab-button {
              padding: 8px 12px !important;
              font-size: 12px !important;
              white-space: nowrap !important;
            }
            
            /* Content Sections Mobile */
            .content-section {
              padding: 16px !important;
            }
            .section-title {
              font-size: 1.1rem !important;
              margin-bottom: 12px !important;
            }
            
            /* KPI Cards Mobile */
            .kpi-grid {
              grid-template-columns: repeat(2, 1fr) !important;
              gap: 8px !important;
            }
            .kpi-card {
              padding: 12px !important;
            }
            .kpi-label {
              font-size: 11px !important;
            }
            .kpi-value {
              font-size: 16px !important;
            }
            
            /* Overview Grid Mobile */
            .overview-grid {
              grid-template-columns: 1fr !important;
              gap: 12px !important;
            }
            .overview-item {
              padding: 8px 0 !important;
            }
            .overview-label {
              font-size: 11px !important;
            }
            .overview-value {
              font-size: 14px !important;
            }
            
            /* Tables Mobile */
            .table-container {
              overflow-x: auto !important;
              -webkit-overflow-scrolling: touch !important;
            }
            .table-container table {
              min-width: 600px !important;
            }
            .table-container th,
            .table-container td {
              padding: 8px 6px !important;
              font-size: 11px !important;
            }
            .table-container th {
              font-size: 10px !important;
            }
            
            /* Charts Mobile */
            .chart-container {
              height: 200px !important;
              margin: 12px 0 !important;
            }
            
            /* ETF Grid Mobile */
            .etf-grid {
              grid-template-columns: repeat(2, 1fr) !important;
              gap: 8px !important;
            }
            .etf-item {
              padding: 8px !important;
            }
            .etf-label {
              font-size: 10px !important;
            }
            .etf-value {
              font-size: 12px !important;
            }
            
            /* News Items Mobile */
            .news-item {
              padding: 12px !important;
              margin-bottom: 8px !important;
            }
            .news-title {
              font-size: 14px !important;
              line-height: 1.3 !important;
            }
            .news-meta {
              font-size: 10px !important;
              margin-top: 6px !important;
            }
            
            /* Holdings Table Mobile */
            .holdings-table {
              font-size: 10px !important;
            }
            .holdings-table th,
            .holdings-table td {
              padding: 6px 4px !important;
            }
            
            /* Back Button Mobile */
            .back-button {
              padding: 6px 8px !important;
              font-size: 12px !important;
            }
          }
          
          @media (max-width: 480px) {
            .mobile-card {
              padding: 16px !important;
            }
            .mobile-header {
              padding: 8px 12px !important;
            }
            .mobile-main {
              padding: 8px !important;
            }
            
            /* Extra small mobile adjustments */
            .search-title {
              font-size: 1.25rem !important;
            }
            .search-input {
              font-size: 12px !important;
              padding: 10px 10px 10px 36px !important;
            }
            .search-btn {
              padding: 6px 10px !important;
              font-size: 12px !important;
            }
            .company-name {
              font-size: 1.25rem !important;
            }
            .kpi-grid {
              grid-template-columns: 1fr !important;
              gap: 6px !important;
            }
            .etf-grid {
              grid-template-columns: 1fr !important;
              gap: 6px !important;
            }
            .tab-button {
              padding: 6px 8px !important;
              font-size: 11px !important;
            }
            
            /* Extra small mobile - make buttons even more compact */
            .quick-search-btn {
              flex: 0 0 calc(25% - 2px) !important;
              font-size: 9px !important;
              padding: 1px 3px !important;
            }
          }
        </style>
        <aside id="pitchlense-navbar" class="bg-[#2C2F34] border border-white/10 rounded-[18px] flex flex-col items-center py-4 gap-3">
          <nav class="flex flex-col gap-2 text-white/80 w-full items-center">
            <a class="w-10 h-10 grid place-items-center rounded-lg hover:bg-white/10" href="/create-report.html" title="Create">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="18" height="18" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <line x1="12" y1="5" x2="12" y2="19"/>
                <line x1="5" y1="12" x2="19" y2="12"/>
              </svg>
            </a>
            <a class="w-10 h-10 grid place-items-center rounded-lg hover:bg-white/10" href="/view-report.html" title="Reports">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="18" height="18" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <rect x="3" y="3" width="18" height="18" rx="2"/>
                <line x1="9" y1="17" x2="9" y2="11"/>
                <line x1="13" y1="17" x2="13" y2="7"/>
                <line x1="17" y1="17" x2="17" y2="13"/>
              </svg>
            </a>
            <a class="w-10 h-10 grid place-items-center rounded-lg hover:bg-white/10 relative group" href="/market.html" title="Market">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="18" height="18" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M3 3v18h18"/>
                <path d="M18.7 8l-5.1 5.2-2.8-2.7L7 14.3"/>
              </svg>
              <div class="absolute left-full ml-2 px-3 py-2 bg-[#1E1E21] text-white text-sm rounded-lg shadow-lg opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-200 whitespace-nowrap z-50">
                Market Data
                <div class="absolute right-full top-1/2 transform -translate-y-1/2 w-0 h-0 border-t-4 border-b-4 border-r-4 border-transparent border-r-[#1E1E21]"></div>
              </div>
            </a>
            <a class="w-10 h-10 grid place-items-center rounded-lg hover:bg-white/10 relative group" href="/investment.html" title="Investments">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="18" height="18" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <line x1="12" y1="1" x2="12" y2="23"></line>
                <path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"></path>
              </svg>
              <div class="absolute left-full ml-2 px-3 py-2 bg-[#1E1E21] text-white text-sm rounded-lg shadow-lg opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-200 whitespace-nowrap z-50">
                Investments
                <div class="absolute right-full top-1/2 transform -translate-y-1/2 w-0 h-0 border-t-4 border-b-4 border-r-4 border-transparent border-r-[#1E1E21]"></div>
              </div>
            </a>
            <a class="w-10 h-10 grid place-items-center rounded-lg bg-white/10 hover:bg-white/10 relative group" href="/search.html" title="Search">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="18" height="18" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <circle cx="11" cy="11" r="8"></circle>
                <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
              </svg>
              <div class="absolute left-full ml-2 px-3 py-2 bg-[#1E1E21] text-white text-sm rounded-lg shadow-lg opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-200 whitespace-nowrap z-50">
                Search Symbols
                <div class="absolute right-full top-1/2 transform -translate-y-1/2 w-0 h-0 border-t-4 border-b-4 border-r-4 border-transparent border-r-[#1E1E21]"></div>
              </div>
            </a>
            <a class="w-10 h-10 grid place-items-center rounded-lg hover:bg-white/10 relative group" href="/news.html" title="News">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="18" height="18" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M3 3h16a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z"/>
                <line x1="7" y1="8" x2="17" y2="8"/>
                <line x1="7" y1="12" x2="17" y2="12"/>
                <line x1="7" y1="16" x2="13" y2="16"/>
              </svg>
              <div class="absolute left-full ml-2 px-3 py-2 bg-[#1E1E21] text-white text-sm rounded-lg shadow-lg opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-200 whitespace-nowrap z-50">
                Market News
                <div class="absolute right-full top-1/2 transform -translate-y-1/2 w-0 h-0 border-t-4 border-b-4 border-r-4 border-transparent border-r-[#1E1E21]"></div>
              </div>
            </a>
            <a class="w-10 h-10 grid place-items-center rounded-lg hover:bg-white/10 relative group" href="/extension.html" title="Extension">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="18" height="18" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <rect x="3" y="3" width="7" height="7"/>
                <rect x="14" y="3" width="7" height="7"/>
                <rect x="14" y="14" width="7" height="7"/>
                <rect x="3" y="14" width="7" height="7"/>
              </svg>
              <div class="absolute left-full ml-2 px-3 py-2 bg-[#1E1E21] text-white text-sm rounded-lg shadow-lg opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-200 whitespace-nowrap z-50">
                Extension
                <div class="absolute right-full top-1/2 transform -translate-y-1/2 w-0 h-0 border-t-4 border-b-4 border-r-4 border-transparent border-r-[#1E1E21]"></div>
              </div>
            </a>
            <a class="w-10 h-10 grid place-items-center rounded-lg hover:bg-white/10 relative group" href="/email.html" title="Email">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="18" height="18" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"/>
                <polyline points="22,6 12,13 2,6"/>
              </svg>
              <div class="absolute left-full ml-2 px-3 py-2 bg-[#1E1E21] text-white text-sm rounded-lg shadow-lg opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-200 whitespace-nowrap z-50">
                Email Client
                <div class="absolute right-full top-1/2 transform -translate-y-1/2 w-0 h-0 border-t-4 border-b-4 border-r-4 border-transparent border-r-[#1E1E21]"></div>
              </div>
            </a>
          <a class="flex items-center gap-3 px-3 py-2 rounded-lg hover:bg-white/10" href="/profile.html">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="18" height="18" fill="currentColor">
              <path d="M12 12a4 4 0 1 0-4-4 4 4 0 0 0 4 4Zm0 2c-3.31 0-6 2.69-6 6h12c0-3.31-2.69-6-6-6Z"/>
            </svg>
            <span>Profile</span>
          </a>
            <a class="w-10 h-10 grid place-items-center rounded-lg hover:bg-white/10 relative group" href="https://youtu.be/XUuLeXaEIdI" target="_blank" title="How to use PitchLense">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="18" height="18" fill="currentColor">
                <path d="M23.498 6.186a3.016 3.016 0 0 0-2.122-2.136C19.505 3.545 12 3.545 12 3.545s-7.505 0-9.377.505A3.017 3.017 0 0 0 .502 6.186C0 8.07 0 12 0 12s0 3.93.502 5.814a3.016 3.016 0 0 0 2.122 2.136c1.871.505 9.376.505 9.376.505s7.505 0 9.377-.505a3.015 3.015 0 0 0 2.122-2.136C24 15.93 24 12 24 12s0-3.93-.502-5.814zM9.545 15.568V8.432L15.818 12l-6.273 3.568z"/>
              </svg>
              <div class="absolute left-full ml-2 px-3 py-2 bg-[#1E1E21] text-white text-sm rounded-lg shadow-lg opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-200 whitespace-nowrap z-50">
                How to use PitchLense
                <div class="absolute right-full top-1/2 transform -translate-y-1/2 w-0 h-0 border-t-4 border-b-4 border-r-4 border-transparent border-r-[#1E1E21]"></div>
              </div>
            </a>
          </nav>
          <div class="flex-1"></div>
          <button id="signoutBtn" class="w-10 h-10 grid place-items-center rounded-lg hover:bg-white/10 text-white/80" title="Sign out">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="18" height="18" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/>
              <polyline points="16 17 21 12 16 7"/>
              <line x1="21" y1="12" x2="9" y2="12"/>
            </svg>
          </button>
        </aside>

        <!-- Main Content -->
        <main class="flex-1 flex flex-col overflow-hidden bg-[#2E3137] border border-white/10 rounded-[14px] mobile-main">
            <!-- Search View -->
            <div id="searchView">
                <!-- Search Header -->
                <div class="bg-[#2C2F34] border-b border-white/10 p-6 search-header">
                    <div class="max-w-2xl mx-auto">
                        <h1 class="text-2xl font-bold mb-4 search-title">Search Stocks & Symbols</h1>
                        <div class="relative">
                            <input
                                type="text"
                                id="searchInput"
                                placeholder="Search for stocks, ETFs, indices, mutual funds, forex, or cryptocurrencies..."
                                class="w-full search-input px-6 py-4 pl-12 text-lg rounded-xl focus:outline-none focus:ring-2 focus:ring-[#FFF27A] focus:border-transparent"
                            >
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="24" height="24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="absolute left-4 top-1/2 transform -translate-y-1/2 text-white/40">
                                <circle cx="11" cy="11" r="8"/>
                                <path d="m21 21-4.35-4.35"/>
                            </svg>
                            <button
                                id="searchBtn"
                                class="absolute right-3 top-1/2 transform -translate-y-1/2 bg-[#FFF27A] text-[#1E1E21] px-4 py-2 rounded-lg font-semibold hover:bg-[#f0e068] transition-colors search-btn"
                            >
                                Search
                            </button>
                        </div>
                        
                        <!-- Quick Search Buttons -->
                        <div class="mt-4">
                            <div class="text-sm text-white/60 mb-3 quick-search-text">Quick Search - Top 10 Companies:</div>
                            <div id="quickSearchButtons" class="flex flex-wrap gap-0.5 quick-search-buttons"></div>
                        </div>
                    </div>
                </div>

                <!-- Search Results -->
                <div id="loadingState" class="flex-1 flex items-center justify-center">
                    <div class="text-center">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="48" height="48" fill="none" stroke="currentColor" stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="mx-auto mb-4 opacity-50">
                            <circle cx="11" cy="11" r="8"/>
                            <path d="m21 21-4.35-4.35"/>
                        </svg>
                        <p>Search for stocks, ETFs, and more</p>
                    </div>
                </div>

                <div id="resultsContainer" class="flex-1 overflow-y-auto p-6 hidden search-results-container">
                    <div id="searchResults" class="max-w-4xl mx-auto space-y-4">
                        <!-- Results will be populated here -->
                    </div>
                </div>

                <!-- No Results State -->
                <div id="noResultsState" class="flex-1 flex items-center justify-center hidden">
                    <div class="text-center">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="48" height="48" fill="none" stroke="currentColor" stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="mx-auto mb-4 opacity-50">
                            <circle cx="11" cy="11" r="8"/>
                            <path d="m21 21-4.35-4.35"/>
                        </svg>
                        <p>No results found</p>
                        <p class="text-white/60 mt-2">Try adjusting your search terms</p>
                    </div>
                </div>
            </div>

            <!-- Company Details View -->
            <div id="companyView" class="hidden flex-1 flex flex-col overflow-hidden">
                <!-- Company Header -->
                <div class="bg-[#2C2F34] border-b border-white/10 p-6 company-header">
                    <div class="flex items-center justify-between mb-4">
                        <button id="backBtn" class="flex items-center gap-2 text-white/80 hover:text-white back-button">
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="20" height="20" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <line x1="19" y1="12" x2="5" y2="12"/>
                                <polyline points="12 19 5 12 12 5"/>
                            </svg>
                            Back to Search
                        </button>
                    </div>
                    <div id="companyHeader">
                        <!-- Company header will be populated here -->
                    </div>
                </div>

                <!-- Loading State -->
                <div id="companyLoading" class="flex-1 flex items-center justify-center">
                    <div class="text-center">
                        <div class="spinner mx-auto mb-4"></div>
                        <p>Loading company data...</p>
                    </div>
                </div>

                <!-- Company Data -->
                <div id="companyData" class="hidden flex-1 overflow-y-auto p-6 content-section">
                    <div class="max-w-7xl mx-auto space-y-6">
                        <!-- KPI Cards -->
                        <div id="kpiSection" class="grid grid-cols-2 md:grid-cols-4 gap-4 kpi-grid">
                            <!-- KPIs will be populated here -->
                        </div>

                        <!-- Company Overview -->
                        <div id="overviewSection" class="data-card">
                            <!-- Overview will be populated here -->
                        </div>

                        <!-- Financial Charts -->
                        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                            <div class="data-card">
                                <div class="section-title">Revenue & Earnings</div>
                                <div class="chart-container">
                                    <canvas id="revenueChart"></canvas>
                                </div>
                            </div>
                            <div class="data-card">
                                <div class="section-title">Balance Sheet</div>
                                <div class="chart-container">
                                    <canvas id="balanceChart"></canvas>
                                </div>
                            </div>
                        </div>

                        <!-- Financial Tables -->
                        <div id="financialsSection" class="space-y-6">
                            <!-- Financial tables will be populated here -->
                        </div>

                        <!-- Dividends & Splits -->
                        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                            <div id="dividendsSection" class="data-card">
                                <!-- Dividends will be populated here -->
                            </div>
                            <div id="splitsSection" class="data-card">
                                <!-- Splits will be populated here -->
                            </div>
                        </div>

                        <!-- ETF Holdings -->
                        <div id="etfSection" class="data-card hidden">
                            <!-- ETF data will be populated here -->
                        </div>

                        <!-- Earnings -->
                        <div id="earningsSection" class="data-card">
                            <!-- Earnings will be populated here -->
                        </div>

                        <!-- News -->
                        <div id="newsSection" class="data-card">
                            <div class="section-title">Latest News</div>
                            <div id="newsContainer">
                                <!-- News will be populated here -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
      </div>
    </div>

    <script src="/static/cache-util.js"></script>
    <script>
        // Initialize cache manager
        const apiCache = new CacheManager('pitchlense_search');
        
        // Clear old cache on page load
        apiCache.clearOldCache();
        
        // Log cache statistics
        const cacheStats = apiCache.getStats();
        if (cacheStats) {
            }
        
        let searchTimeout;
        let currentSearchTerm = '';
        let currentSymbol = '';
        let companyData = null;
        let chartInstances = {
            revenue: null,
            balance: null
        };

        // Top 10 companies for quick search
        const top10Companies = [
            'AAPL', 'MSFT', 'GOOGL', 'AMZN', 'NVDA', 'META', 'TSLA', 'V', 'UNH'
        ];

        // Initialize the search page
        document.addEventListener('DOMContentLoaded', function() {
            initializeSearchPage();
            setupEventListeners();
            populateQuickSearchButtons();
        });

        function initializeSearchPage() {
            // Load user email if available
            const userEmail = localStorage.getItem('userEmail');
            if (userEmail) {
                document.getElementById('userEmailText').textContent = userEmail;
            }
        }

        // Populate quick search buttons
        function populateQuickSearchButtons() {
            const container = document.getElementById('quickSearchButtons');
            if (!container) return;
            
            // Only populate once
            if (container.children.length > 0) return;
            
            top10Companies.forEach(symbol => {
                const button = document.createElement('button');
                button.className = 'px-3 py-1.5 bg-[#1E1E21] hover:bg-[#FFF27A] hover:text-[#1E1E21] border border-white/10 hover:border-[#FFF27A] rounded-lg text-xs font-semibold text-white transition-all quick-search-btn';
                button.textContent = symbol;
                button.onclick = () => {
                    const input = document.getElementById('searchInput');
                    if (input) {
                        input.value = symbol;
                    }
                    // Directly load company details instead of performing search
                    loadCompanyDetails(symbol);
                };
                container.appendChild(button);
            });
        }

        function setupEventListeners() {
            const searchInput = document.getElementById('searchInput');
            const searchBtn = document.getElementById('searchBtn');
            const backBtn = document.getElementById('backBtn');

            // Search on input change with debounce
            searchInput.addEventListener('input', function() {
                clearTimeout(searchTimeout);
                const query = this.value.trim();

                if (query.length >= 2) {
                    searchTimeout = setTimeout(() => performSearch(query), 300);
                } else if (query.length === 0) {
                    showLoadingState();
                } else {
                    showLoadingState();
                }
            });

            // Search on button click
            searchBtn.addEventListener('click', function() {
                const query = searchInput.value.trim();
                if (query) {
                    performSearch(query);
                }
            });

            // Search on Enter key
            searchInput.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    e.preventDefault();
                    const query = this.value.trim();
                    if (query) {
                        performSearch(query);
                    }
                }
            });

            // Back to search
            backBtn.addEventListener('click', function() {
                showSearchView();
            });
        }

        async function performSearch(query) {
            if (!query || query === currentSearchTerm) return;

            currentSearchTerm = query;
            showLoadingState();

            try {
                const response = await cachedFetch(`/api/search/fmp?query=${encodeURIComponent(query)}`, {
                    method: 'GET',
                    credentials: 'include'
                });

                if (!response.ok) {
                    let errorData = { error: 'Search failed', details: `HTTP ${response.status}` };
                    try {
                        errorData = await response.json();
                    } catch (e) {
                        // Response is not JSON (probably HTML error page)
                        const text = await response.text();
                        console.error('[search] Non-JSON response:', text.substring(0, 200));
                        errorData.details = 'Server returned an error page. Check backend console.';
                    }
                    
                    console.error('[search] Backend Error:', errorData);
                    throw new Error(errorData.error || 'Search failed');
                }

                const results = await response.json();

                if (!results.success || !results.results || results.results.length === 0) {
                    showNoResultsState();
                } else {
                    displaySearchResults(results.results);
                }

            } catch (error) {
                console.error('Search error:', error);
                showNoResultsState();

                Swal.fire({
                    icon: 'error',
                    title: 'Search Failed',
                    text: error.message || 'Unable to perform search',
                    confirmButtonText: 'OK'
                });
            }
        }

        function showLoadingState() {
            document.getElementById('loadingState').classList.remove('hidden');
            document.getElementById('resultsContainer').classList.add('hidden');
            document.getElementById('noResultsState').classList.add('hidden');
        }

        function displaySearchResults(results) {
            document.getElementById('loadingState').classList.add('hidden');
            document.getElementById('noResultsState').classList.add('hidden');
            document.getElementById('resultsContainer').classList.remove('hidden');

            const container = document.getElementById('searchResults');
            container.innerHTML = '';

            results.forEach(result => {
                const resultElement = createResultElement(result);
                container.appendChild(resultElement);
            });
        }

        function showNoResultsState() {
            document.getElementById('loadingState').classList.add('hidden');
            document.getElementById('resultsContainer').classList.add('hidden');
            document.getElementById('noResultsState').classList.remove('hidden');
        }

        function createResultElement(result) {
            const div = document.createElement('div');
            div.className = 'search-result p-4 rounded-lg';
            div.onclick = () => loadCompanyDetails(result.symbol);

            div.innerHTML = `
                <div class="flex items-center justify-between search-result-content">
                    <div class="flex-1">
                        <div class="flex items-center gap-3 mb-2 search-result-header">
                            <span class="symbol-badge search-result-symbol">${result.symbol}</span>
                            <h3 class="text-lg font-semibold search-result-name">${result.name || result.symbol}</h3>
                            ${result.exchange ? `<span class="text-xs text-white/60 bg-white/10 px-2 py-1 rounded search-result-exchange">${result.exchange}</span>` : ''}
                        </div>
                        <p class="text-white/70 text-sm mb-2 search-result-details">${result.exchangeFullName || 'No exchange info available'}</p>
                        ${result.currency ? `<p class="text-white/50 text-xs search-result-details">Currency: ${result.currency}</p>` : ''}
                    </div>

                    <div class="text-right">
                        <div class="text-sm text-white/60">Click to view details</div>
                        <div class="text-xs text-white/40 mt-1">Symbol: ${result.symbol}</div>
                    </div>
                </div>
            `;

            return div;
        }

        async function loadCompanyDetails(symbol) {
            currentSymbol = symbol;
            showCompanyView();

            try {
                // Fetch all company data in parallel
                const [profileResponse, financialsResponse, additionalResponse, newsResponse] = await Promise.allSettled([
                    cachedFetch(`/api/company/profile/${symbol}`, { credentials: 'include' }),
                    cachedFetch(`/api/company/financials/${symbol}`, { credentials: 'include' }),
                    cachedFetch(`/api/company/additional/${symbol}`, { credentials: 'include' }),
                    cachedFetch(`/api/company/news/${symbol}`, { credentials: 'include' })
                ]);

                // Process responses with better error handling
                let profileData = { success: false };
                let financialsData = { success: false };
                let additionalData = { success: false };
                let newsData = { success: false };

                try {
                    if (profileResponse.status === 'fulfilled' && profileResponse.value.ok) {
                        profileData = await profileResponse.value.json();
                    } else if (profileResponse.status === 'fulfilled') {
                        }
                } catch (e) {
                    }

                try {
                    if (financialsResponse.status === 'fulfilled' && financialsResponse.value.ok) {
                        financialsData = await financialsResponse.value.json();
                    } else if (financialsResponse.status === 'fulfilled') {
                        }
                } catch (e) {
                    }

                try {
                    if (additionalResponse.status === 'fulfilled' && additionalResponse.value.ok) {
                        additionalData = await additionalResponse.value.json();
                    } else if (additionalResponse.status === 'fulfilled') {
                        }
                } catch (e) {
                    }

                try {
                    if (newsResponse.status === 'fulfilled' && newsResponse.value.ok) {
                        newsData = await newsResponse.value.json();
                    } else if (newsResponse.status === 'fulfilled') {
                        }
                } catch (e) {
                    }

                // Combine all data
                companyData = {
                    profile: profileData.success ? profileData.profile : null,
                    financials: financialsData.success ? financialsData : null,
                    additional: additionalData.success ? additionalData : null,
                    news: newsData.success ? newsData : null
                };

                // Show status of data availability
                const availableData = [];
                if (companyData.profile) availableData.push('Profile');
                if (companyData.financials) availableData.push('Financials');
                if (companyData.additional) availableData.push('Additional Data');
                if (companyData.news) availableData.push('News');

                displayCompanyData();

            } catch (error) {
                console.error('Error loading company data:', error);
                Swal.fire({
                    icon: 'error',
                    title: 'Error',
                    text: 'Failed to load company data',
                    confirmButtonText: 'OK'
                });
                showSearchView();
            }
        }

        function showSearchView() {
            document.getElementById('searchView').classList.remove('hidden');
            document.getElementById('companyView').classList.add('hidden');
        }

        function showCompanyView() {
            document.getElementById('searchView').classList.add('hidden');
            document.getElementById('companyView').classList.remove('hidden');
            document.getElementById('companyLoading').classList.remove('hidden');
            document.getElementById('companyData').classList.add('hidden');
        }

        function displayCompanyData() {
            const profile = companyData.profile;
            
            if (!profile || !profile.symbol) {
                Swal.fire({
                    icon: 'warning',
                    title: 'No Data',
                    text: 'No data available for this symbol',
                    confirmButtonText: 'OK'
                });
                showSearchView();
                return;
            }

            // Display header
            displayCompanyHeader(profile);

            // Display KPIs
            displayKPIs(profile);

            // Display overview
            displayOverview(profile);

            // Display financial charts
            displayFinancialCharts();

            // Display financial tables
            displayFinancialTables();

            // Display executives
            displayExecutives();

            // Display dividends
            displayDividends();

            // Display news
            displayNews();


            // Show company data
            document.getElementById('companyLoading').classList.add('hidden');
            document.getElementById('companyData').classList.remove('hidden');
        }

        function displayCompanyHeader(profile) {
            const header = document.getElementById('companyHeader');
            const marketCap = profile.marketCap ? 
                `$${(parseInt(profile.marketCap) / 1000000000).toFixed(2)}B` : 'N/A';

            header.innerHTML = `
                <div class="flex items-center justify-between company-title-section">
                    <div>
                        <div class="flex items-center gap-3 mb-2">
                            <span class="symbol-badge text-lg px-3 py-1 company-symbol">${profile.symbol}</span>
                            <h1 class="text-2xl font-bold company-name">${profile.companyName}</h1>
                        </div>
                        <div class="flex items-center gap-4 text-white/70 company-meta">
                            <span>${profile.exchange || 'N/A'}</span>
                            <span>•</span>
                            <span>${profile.sector || 'N/A'}</span>
                            <span>•</span>
                            <span>${profile.industry || 'N/A'}</span>
                        </div>
                    </div>
                    <div class="text-right">
                        <div class="text-sm text-white/60">Market Cap</div>
                        <div class="text-2xl font-bold">${marketCap}</div>
                    </div>
                </div>
                
                <!-- Mobile Layout -->
                <div class="md:hidden mobile-company-header">
                    <div class="flex items-center gap-2 mb-2">
                        <span class="symbol-badge text-sm px-2 py-1">${profile.symbol}</span>
                        <h1 class="text-lg font-bold">${profile.companyName}</h1>
                        <span class="text-sm text-white/70">${profile.sector || 'N/A'}</span>
                    </div>
                    <div class="flex items-center gap-2">
                        <span class="text-sm text-white/60">Market Cap:</span>
                        <span class="text-lg font-bold">${marketCap}</span>
                    </div>
                </div>
            `;
        }

        function displayKPIs(profile) {
            const kpiSection = document.getElementById('kpiSection');
            
            const kpis = [
                { label: 'Price', value: profile.price ? `$${profile.price.toFixed(2)}` : 'N/A' },
                { label: 'Change', value: profile.change ? `${profile.change > 0 ? '+' : ''}${profile.change.toFixed(2)}` : 'N/A' },
                { label: 'Change %', value: profile.changePercentage ? `${profile.changePercentage > 0 ? '+' : ''}${profile.changePercentage.toFixed(2)}%` : 'N/A' },
                { label: 'Volume', value: profile.volume ? profile.volume.toLocaleString() : 'N/A' },
                { label: 'Avg Volume', value: profile.averageVolume ? profile.averageVolume.toLocaleString() : 'N/A' },
                { label: 'Beta', value: profile.beta || 'N/A' },
                { label: 'Last Dividend', value: profile.lastDividend ? `$${profile.lastDividend}` : 'N/A' },
                { label: 'Range', value: profile.range || 'N/A' }
            ];

            kpiSection.innerHTML = kpis.map(kpi => `
                <div class="kpi-card">
                    <div class="text-white/60 text-sm mb-1 kpi-label">${kpi.label}</div>
                    <div class="text-xl font-bold kpi-value">${kpi.value}</div>
                </div>
            `).join('');
        }

        function displayOverview(profile) {
            const overviewSection = document.getElementById('overviewSection');
            overviewSection.innerHTML = `
                <div class="section-title">Company Overview</div>
                <p class="text-white/80 mb-4">${profile.description || 'No description available'}</p>
                <div class="grid grid-cols-2 md:grid-cols-3 gap-4 overview-grid">
                    <div class="overview-item">
                        <div class="text-white/60 text-sm overview-label">Country</div>
                        <div class="font-semibold overview-value">${profile.country || 'N/A'}</div>
                    </div>
                    <div class="overview-item">
                        <div class="text-white/60 text-sm overview-label">Currency</div>
                        <div class="font-semibold overview-value">${profile.currency || 'N/A'}</div>
                    </div>
                    <div class="overview-item">
                        <div class="text-white/60 text-sm overview-label">CEO</div>
                        <div class="font-semibold overview-value">${profile.ceo || 'N/A'}</div>
                    </div>
                    <div class="overview-item">
                        <div class="text-white/60 text-sm overview-label">IPO Date</div>
                        <div class="font-semibold overview-value">${profile.ipoDate || 'N/A'}</div>
                    </div>
                    <div class="overview-item">
                        <div class="text-white/60 text-sm overview-label">Employees</div>
                        <div class="font-semibold overview-value">${profile.fullTimeEmployees ? parseInt(profile.fullTimeEmployees).toLocaleString() : 'N/A'}</div>
                    </div>
                    <div class="overview-item">
                        <div class="text-white/60 text-sm overview-label">Phone</div>
                        <div class="font-semibold overview-value">${profile.phone || 'N/A'}</div>
                    </div>
                </div>
                <div class="mt-4">
                    <div class="text-white/60 text-sm mb-2">Address</div>
                    <div class="font-semibold">${profile.address || ''} ${profile.city || ''} ${profile.state || ''} ${profile.zip || ''}</div>
                </div>
                ${profile.website ? `
                <div class="mt-4">
                    <a href="${profile.website}" target="_blank" class="text-[#FFF27A] hover:underline">
                        Visit Official Website →
                    </a>
                </div>
                ` : ''}
            `;
        }

        function displayFinancialCharts() {
            // Destroy existing charts before creating new ones
            if (chartInstances.revenue) {
                chartInstances.revenue.destroy();
                chartInstances.revenue = null;
            }
            if (chartInstances.balance) {
                chartInstances.balance.destroy();
                chartInstances.balance = null;
            }

            // Revenue Chart
            if (companyData.financials && companyData.financials.incomeStatement && companyData.financials.incomeStatement.length > 0) {
                const reports = companyData.financials.incomeStatement.slice(0, 5);
                const labels = reports.map(r => r.date);
                const revenue = reports.map(r => parseInt(r.revenue) / 1000000000);
                const netIncome = reports.map(r => parseInt(r.netIncome) / 1000000000);

                const ctx = document.getElementById('revenueChart').getContext('2d');
                chartInstances.revenue = new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: labels,
                        datasets: [{
                            label: 'Revenue (B)',
                            data: revenue,
                            borderColor: '#FFF27A',
                            backgroundColor: 'rgba(255, 242, 122, 0.1)',
                            tension: 0.4
                        }, {
                            label: 'Net Income (B)',
                            data: netIncome,
                            borderColor: '#10b981',
                            backgroundColor: 'rgba(16, 185, 129, 0.1)',
                            tension: 0.4
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: true,
                        plugins: {
                            legend: {
                                labels: { color: '#fff' }
                            }
                        },
                        scales: {
                            y: {
                                ticks: { color: '#fff' },
                                grid: { color: 'rgba(255,255,255,0.1)' }
                            },
                            x: {
                                ticks: { color: '#fff' },
                                grid: { color: 'rgba(255,255,255,0.1)' }
                            }
                        }
                    }
                });
            } else {
                // Show no data message for revenue chart
                const ctx = document.getElementById('revenueChart').getContext('2d');
                ctx.fillStyle = '#666';
                ctx.font = '16px Arial';
                ctx.textAlign = 'center';
                ctx.fillText('No financial data available', ctx.canvas.width/2, ctx.canvas.height/2);
            }

            // Balance Sheet Chart
            if (companyData.financials && companyData.financials.balanceSheet && companyData.financials.balanceSheet.length > 0) {
                const reports = companyData.financials.balanceSheet.slice(0, 5);
                const labels = reports.map(r => r.date);
                const assets = reports.map(r => parseInt(r.totalAssets) / 1000000000);
                const liabilities = reports.map(r => parseInt(r.totalLiabilities) / 1000000000);

                const ctx = document.getElementById('balanceChart').getContext('2d');
                chartInstances.balance = new Chart(ctx, {
                    type: 'bar',
                    data: {
                        labels: labels,
                        datasets: [{
                            label: 'Assets (B)',
                            data: assets,
                            backgroundColor: '#FFF27A'
                        }, {
                            label: 'Liabilities (B)',
                            data: liabilities,
                            backgroundColor: '#ef4444'
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: true,
                        plugins: {
                            legend: {
                                labels: { color: '#fff' }
                            }
                        },
                        scales: {
                            y: {
                                ticks: { color: '#fff' },
                                grid: { color: 'rgba(255,255,255,0.1)' }
                            },
                            x: {
                                ticks: { color: '#fff' },
                                grid: { color: 'rgba(255,255,255,0.1)' }
                            }
                        }
                    }
                });
            } else {
                // Show no data message for balance chart
                const ctx = document.getElementById('balanceChart').getContext('2d');
                ctx.fillStyle = '#666';
                ctx.font = '16px Arial';
                ctx.textAlign = 'center';
                ctx.fillText('No balance sheet data available', ctx.canvas.width/2, ctx.canvas.height/2);
            }
        }

        function displayFinancialTables() {
            const section = document.getElementById('financialsSection');
            let html = '';

            // Income Statement
            if (companyData.financials && companyData.financials.incomeStatement && companyData.financials.incomeStatement.length > 0) {
                const reports = companyData.financials.incomeStatement.slice(0, 3);
                html += `
                    <div class="data-card">
                        <div class="section-title">Income Statement (Annual)</div>
                        <div class="table-container">
                            <table>
                                <thead>
                                    <tr>
                                        <th>Year</th>
                                        <th>Revenue</th>
                                        <th>Gross Profit</th>
                                        <th>Operating Income</th>
                                        <th>Net Income</th>
                                        <th>EPS</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    ${reports.map(r => `
                                        <tr>
                                            <td>${r.date}</td>
                                            <td>$${(parseInt(r.revenue) / 1000000000).toFixed(2)}B</td>
                                            <td>$${(parseInt(r.grossProfit) / 1000000000).toFixed(2)}B</td>
                                            <td>$${(parseInt(r.operatingIncome) / 1000000000).toFixed(2)}B</td>
                                            <td>$${(parseInt(r.netIncome) / 1000000000).toFixed(2)}B</td>
                                            <td>$${r.eps || 'N/A'}</td>
                                        </tr>
                                    `).join('')}
                                </tbody>
                            </table>
                        </div>
                    </div>
                `;
            } else {
                html += `
                    <div class="data-card">
                        <div class="section-title">Income Statement (Annual)</div>
                        <p class="text-white/60">No income statement data available</p>
                    </div>
                `;
            }

            // Balance Sheet
            if (companyData.financials && companyData.financials.balanceSheet && companyData.financials.balanceSheet.length > 0) {
                const reports = companyData.financials.balanceSheet.slice(0, 3);
                html += `
                    <div class="data-card">
                        <div class="section-title">Balance Sheet (Annual)</div>
                        <div class="table-container">
                            <table>
                                <thead>
                                    <tr>
                                        <th>Year</th>
                                        <th>Total Assets</th>
                                        <th>Total Liabilities</th>
                                        <th>Shareholder Equity</th>
                                        <th>Cash</th>
                                        <th>Long-term Debt</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    ${reports.map(r => `
                                        <tr>
                                            <td>${r.date}</td>
                                            <td>$${(parseInt(r.totalAssets) / 1000000000).toFixed(2)}B</td>
                                            <td>$${(parseInt(r.totalLiabilities) / 1000000000).toFixed(2)}B</td>
                                            <td>$${(parseInt(r.totalStockholdersEquity) / 1000000000).toFixed(2)}B</td>
                                            <td>$${(parseInt(r.cashAndCashEquivalents || 0) / 1000000000).toFixed(2)}B</td>
                                            <td>$${(parseInt(r.longTermDebt || 0) / 1000000000).toFixed(2)}B</td>
                                        </tr>
                                    `).join('')}
                                </tbody>
                            </table>
                        </div>
                    </div>
                `;
            } else {
                html += `
                    <div class="data-card">
                        <div class="section-title">Balance Sheet (Annual)</div>
                        <p class="text-white/60">No balance sheet data available</p>
                    </div>
                `;
            }

            section.innerHTML = html;
        }

        function displayExecutives() {
            const section = document.getElementById('earningsSection');
            
            if (companyData.additional && companyData.additional.executives && companyData.additional.executives.length > 0) {
                const executives = companyData.additional.executives.slice(0, 10);
                section.innerHTML = `
                    <div class="section-title">Key Executives</div>
                    <div class="table-container">
                        <table>
                            <thead>
                                <tr>
                                    <th>Name</th>
                                    <th>Title</th>
                                    <th>Pay</th>
                                    <th>Gender</th>
                                    <th>Year Born</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${executives.map(e => `
                                    <tr>
                                        <td class="font-semibold">${e.name || 'N/A'}</td>
                                        <td>${e.title || 'N/A'}</td>
                                        <td>${e.pay ? `$${parseInt(e.pay).toLocaleString()}` : 'N/A'}</td>
                                        <td>${e.gender || 'N/A'}</td>
                                        <td>${e.yearBorn || 'N/A'}</td>
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>
                    </div>
                `;
            } else {
                section.innerHTML = `
                    <div class="section-title">Key Executives</div>
                    <p class="text-white/60">No executive data available</p>
                `;
            }
        }

        function displayDividends() {
            const section = document.getElementById('dividendsSection');
            
            if (companyData.additional && companyData.additional.dividends && companyData.additional.dividends.length > 0) {
                const dividends = companyData.additional.dividends.slice(0, 10);
                section.innerHTML = `
                    <div class="section-title">Dividend History</div>
                    <div class="table-container">
                        <table>
                            <thead>
                                <tr>
                                    <th>Date</th>
                                    <th>Payment Date</th>
                                    <th>Amount</th>
                                    <th>Yield</th>
                                    <th>Frequency</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${dividends.map(d => `
                                    <tr>
                                        <td>${d.date}</td>
                                        <td>${d.paymentDate}</td>
                                        <td>$${d.dividend}</td>
                                        <td>${(d.yield * 100).toFixed(2)}%</td>
                                        <td>${d.frequency}</td>
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>
                    </div>
                `;
            } else {
                section.innerHTML = `
                    <div class="section-title">Dividend History</div>
                    <p class="text-white/60">No dividend data available</p>
                `;
            }
        }

        function displaySplits() {
            const section = document.getElementById('splitsSection');
            
            if (companyData.splits && companyData.splits.data && companyData.splits.data.length > 0) {
                const splits = companyData.splits.data;
                section.innerHTML = `
                    <div class="section-title">Stock Splits</div>
                    <div class="table-container">
                        <table>
                            <thead>
                                <tr>
                                    <th>Effective Date</th>
                                    <th>Split Factor</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${splits.map(s => `
                                    <tr>
                                        <td>${s.effective_date}</td>
                                        <td>${s.split_factor}</td>
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>
                    </div>
                `;
            } else {
                section.innerHTML = `
                    <div class="section-title">Stock Splits</div>
                    <p class="text-white/60">No split data available</p>
                `;
            }
        }

        function displayETFData() {
            const section = document.getElementById('etfSection');
            const etf = companyData.etf;
            
            if (!etf || !etf.holdings) return;

            section.classList.remove('hidden');
            
            let sectorsHTML = '';
            if (etf.sectors && etf.sectors.length > 0) {
                sectorsHTML = `
                    <div class="mb-6">
                        <h4 class="font-semibold mb-3">Sector Allocation</h4>
                        <div class="space-y-2">
                            ${etf.sectors.map(s => `
                                <div>
                                    <div class="flex justify-between text-sm mb-1">
                                        <span>${s.sector}</span>
                                        <span>${(parseFloat(s.weight) * 100).toFixed(2)}%</span>
                                    </div>
                                    <div class="w-full bg-white/10 rounded-full h-2">
                                        <div class="bg-[#FFF27A] h-2 rounded-full" style="width: ${(parseFloat(s.weight) * 100).toFixed(2)}%"></div>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                `;
            }

            section.innerHTML = `
                <div class="section-title">ETF Information</div>
                <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-6">
                    <div>
                        <div class="text-white/60 text-sm">Net Assets</div>
                        <div class="font-semibold">$${(parseInt(etf.net_assets) / 1000000000).toFixed(2)}B</div>
                    </div>
                    <div>
                        <div class="text-white/60 text-sm">Expense Ratio</div>
                        <div class="font-semibold">${(parseFloat(etf.net_expense_ratio) * 100).toFixed(2)}%</div>
                    </div>
                    <div>
                        <div class="text-white/60 text-sm">Dividend Yield</div>
                        <div class="font-semibold">${(parseFloat(etf.dividend_yield) * 100).toFixed(2)}%</div>
                    </div>
                    <div>
                        <div class="text-white/60 text-sm">Inception Date</div>
                        <div class="font-semibold">${etf.inception_date}</div>
                    </div>
                </div>
                ${sectorsHTML}
                <div>
                    <h4 class="font-semibold mb-3">Top Holdings</h4>
                    <div class="table-container">
                        <table>
                            <thead>
                                <tr>
                                    <th>Symbol</th>
                                    <th>Description</th>
                                    <th>Weight</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${etf.holdings.slice(0, 10).map(h => `
                                    <tr>
                                        <td><span class="symbol-badge">${h.symbol}</span></td>
                                        <td>${h.description}</td>
                                        <td>${(parseFloat(h.weight) * 100).toFixed(2)}%</td>
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>
                    </div>
                </div>
            `;
        }

        function displayEarnings() {
            const section = document.getElementById('earningsSection');
            let html = '<div class="section-title">Earnings</div>';

            // Earnings History
            if (companyData.earnings && companyData.earnings.annualEarnings) {
                const earnings = companyData.earnings.annualEarnings.slice(0, 5);
                html += `
                    <div class="mb-6">
                        <h4 class="font-semibold mb-3">Annual Earnings History</h4>
                        <div class="table-container">
                            <table>
                                <thead>
                                    <tr>
                                        <th>Fiscal Year</th>
                                        <th>Reported EPS</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    ${earnings.map(e => `
                                        <tr>
                                            <td>${e.fiscalDateEnding}</td>
                                            <td>$${e.reportedEPS}</td>
                                        </tr>
                                    `).join('')}
                                </tbody>
                            </table>
                        </div>
                    </div>
                `;
            }

            // Earnings Estimates
            if (companyData.earningsEstimates && companyData.earningsEstimates.estimates) {
                const estimates = companyData.earningsEstimates.estimates.slice(0, 2);
                html += `
                    <div>
                        <h4 class="font-semibold mb-3">Earnings Estimates</h4>
                        <div class="table-container">
                            <table>
                                <thead>
                                    <tr>
                                        <th>Period</th>
                                        <th>Horizon</th>
                                        <th>EPS Estimate (Avg)</th>
                                        <th>Revenue Estimate (Avg)</th>
                                        <th>Analyst Count</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    ${estimates.map(e => `
                                        <tr>
                                            <td>${e.date}</td>
                                            <td>${e.horizon}</td>
                                            <td>$${parseFloat(e.eps_estimate_average).toFixed(2)}</td>
                                            <td>$${(parseInt(e.revenue_estimate_average) / 1000000000).toFixed(2)}B</td>
                                            <td>${e.eps_estimate_analyst_count}</td>
                                        </tr>
                                    `).join('')}
                                </tbody>
                            </table>
                        </div>
                    </div>
                `;
            }

            section.innerHTML = html;
        }

        function displayNews() {
            const container = document.getElementById('newsContainer');
            
            if (companyData.news && companyData.news.pressReleases && companyData.news.pressReleases.length > 0) {
                const news = companyData.news.pressReleases.slice(0, 10);
                
                container.innerHTML = news.map(article => {
                    return `
                        <div class="news-item">
                            <div class="flex justify-between items-start mb-2">
                                <h4 class="font-semibold flex-1 pr-4">
                                    <a href="${article.url}" target="_blank" class="hover:text-[#FFF27A]">
                                        ${article.title}
                                    </a>
                                </h4>
                                <span class="text-sm text-white/60">${article.publisher}</span>
                            </div>
                            <p class="text-white/70 text-sm mb-2">${article.text}</p>
                            <div class="flex items-center gap-4 text-white/50 text-xs">
                                <span>${article.site}</span>
                                <span>•</span>
                                <span>${new Date(article.publishedDate).toLocaleDateString()}</span>
                            </div>
                        </div>
                    `;
                }).join('');
            } else {
                container.innerHTML = '<p class="text-white/60">No news available</p>';
            }
        }


        function formatNumber(num) {
            if (!num) return 'N/A';
            const n = parseInt(num);
            if (n >= 1000000000) return `$${(n / 1000000000).toFixed(2)}B`;
            if (n >= 1000000) return `$${(n / 1000000).toFixed(2)}M`;
            if (n >= 1000) return `$${(n / 1000).toFixed(2)}K`;
            return `$${n.toFixed(2)}`;
        }

        // Check authentication
        fetch('/api/auth/me').then(r=>r.json()).then(d=>{
            if(!d.user){
                window.location.href='/auth.html';
            } else {
                const userEmailText = document.getElementById('userEmailText');
                if (userEmailText) {
                    userEmailText.textContent = d.user.email;
                }
            }
        }).catch(()=> {
            window.location.href='/auth.html';
        });
    </script>
    
    <!-- Mobile Navigation Menu -->
    <div id="mobileMenu" class="fixed inset-0 bg-black/50 backdrop-blur-sm z-50 hidden md:hidden">
      <div class="bg-[#2C2F34] border border-white/10 rounded-[18px] m-4 p-4">
        <div class="flex items-center justify-between mb-4">
          <h3 class="text-lg font-semibold text-white">Navigation</h3>
          <button id="closeMobileMenu" class="w-8 h-8 grid place-items-center rounded-full bg-[#FFF27A] text-[#1E1E21]">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="16" height="16" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <line x1="18" y1="6" x2="6" y2="18"/>
              <line x1="6" y1="6" x2="18" y2="18"/>
            </svg>
          </button>
        </div>
        <nav class="flex flex-col gap-2 text-white/80">
          <a class="flex items-center gap-3 px-3 py-2 rounded-lg hover:bg-white/10" href="/create-report.html">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="18" height="18" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <line x1="12" y1="5" x2="12" y2="19"/>
              <line x1="5" y1="12" x2="19" y2="12"/>
            </svg>
            <span>Create Report</span>
          </a>
          <a class="flex items-center gap-3 px-3 py-2 rounded-lg hover:bg-white/10" href="/view-report.html">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="18" height="18" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <rect x="3" y="3" width="18" height="18" rx="2"/>
              <line x1="9" y1="17" x2="9" y2="11"/>
              <line x1="13" y1="17" x2="13" y2="7"/>
              <line x1="17" y1="17" x2="17" y2="13"/>
            </svg>
            <span>Reports</span>
          </a>
          <a class="flex items-center gap-3 px-3 py-2 rounded-lg hover:bg-white/10" href="/market.html">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="18" height="18" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M3 3v18h18"/>
              <path d="M18.7 8l-5.1 5.2-2.8-2.7L7 14.3"/>
            </svg>
            <span>Market Data</span>
          </a>
          <a class="flex items-center gap-3 px-3 py-2 rounded-lg hover:bg-white/10" href="/investment.html">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="18" height="18" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <line x1="12" y1="1" x2="12" y2="23"></line>
              <path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"></path>
            </svg>
            <span>Investments</span>
          </a>
          <a class="flex items-center gap-3 px-3 py-2 rounded-lg bg-white/10" href="/search.html">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="18" height="18" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <circle cx="11" cy="11" r="8"></circle>
              <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
            </svg>
            <span>Search Symbols</span>
          </a>
          <a class="flex items-center gap-3 px-3 py-2 rounded-lg hover:bg-white/10" href="/news.html">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="18" height="18" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M3 3h16a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z"/>
              <line x1="7" y1="8" x2="17" y2="8"/>
              <line x1="7" y1="12" x2="17" y2="12"/>
              <line x1="7" y1="16" x2="13" y2="16"/>
            </svg>
            <span>Market News</span>
          </a>
          <a class="flex items-center gap-3 px-3 py-2 rounded-lg hover:bg-white/10" href="/extension.html">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="18" height="18" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <rect x="3" y="3" width="7" height="7"/>
              <rect x="14" y="3" width="7" height="7"/>
              <rect x="14" y="14" width="7" height="7"/>
              <rect x="3" y="14" width="7" height="7"/>
            </svg>
            <span>Extension</span>
          </a>
          <a class="flex items-center gap-3 px-3 py-2 rounded-lg hover:bg-white/10" href="/email.html">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="18" height="18" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"/>
              <polyline points="22,6 12,13 2,6"/>
            </svg>
            <span>Email Client</span>
          </a>
          <a class="flex items-center gap-3 px-3 py-2 rounded-lg hover:bg-white/10" href="/walkthrough.html">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="18" height="18" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <circle cx="12" cy="12" r="10"/>
              <polygon points="10,8 16,12 10,16 10,8"/>
            </svg>
            <span>Quick Walkthrough</span>
          </a>
          <!-- Academy link disabled -->
          <!-- <a class="flex items-center gap-3 px-3 py-2 rounded-lg hover:bg-white/10" href="/academy.html"> -->
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="18" height="18" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"/>
              <path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"/>
            </svg>
            <!-- <span>PitchLense Academy</span>
          </a> -->
          
          <div class="border-t border-white/10 my-2"></div>
          <button id="mobileSignoutBtn" class="flex items-center gap-3 px-3 py-2 rounded-lg hover:bg-white/10 text-white/80">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="18" height="18" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/>
              <polyline points="16 17 21 12 16 7"/>
              <line x1="21" y1="12" x2="9" y2="12"/>
            </svg>
            <span>Sign out</span>
          </button>
        </nav>
      </div>
    </div>

    <!-- Mobile Menu JavaScript -->
    <script>
      // Mobile menu functionality
      const mobileMenuBtn = document.getElementById('mobileMenuBtn');
      const mobileMenu = document.getElementById('mobileMenu');
      const closeMobileMenu = document.getElementById('closeMobileMenu');
      const mobileSignoutBtn = document.getElementById('mobileSignoutBtn');

      if (mobileMenuBtn && mobileMenu) {
        mobileMenuBtn.addEventListener('click', () => {
          mobileMenu.classList.remove('hidden');
        });
      }

      if (closeMobileMenu && mobileMenu) {
        closeMobileMenu.addEventListener('click', () => {
          mobileMenu.classList.add('hidden');
        });
      }

      if (mobileSignoutBtn) {
        mobileSignoutBtn.addEventListener('click', async () => {
          try { await fetch('/api/auth/logout',{method:'POST'}); } catch(e) {}
          window.location.href='/auth.html';
        });
      }

      // Close mobile menu when clicking outside
      if (mobileMenu) {
        mobileMenu.addEventListener('click', (e) => {
          if (e.target === mobileMenu) {
            mobileMenu.classList.add('hidden');
          }
        });
      }
    </script>
    
    <script src="/static/navbar.js"></script>
  </body>
</html>



